!function(){"use strict";var CSV,e,t,n;e={existance:function(e){return!(!e||null===e)},number:function(e){return!isNaN(Number(e))},method:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},t={value:function(e){return'"'===e.charAt(0)&&(e=e.substring(1,e.length)),'"'===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e.replace(/(^\s+|\s+$)/g,"").replace(/\"\"/g,'"')},decode:function(n){return""===n?n:e.number(n)?Number(n):"true"===n.toLowerCase()?!0:"false"===n.toLowerCase()?!1:t.value(n)},encode:function(t){return t.map(function(t){return e.number(t)?t:'"'+t+'"'}).join(",")+"\n"},clean:function(e){return e.map(function(e){return t.decode(e)})}},n={rows:function(e,t){var n,r,o,i,s,a,u,c,d;for(n={},r={},o=[],i=e.length,s=0,a=0,d=function(){if(s>=i)return r;if(c)return c=!1,n;var o,a,u,d;if(u=s,34===e.charCodeAt(u)){for(a=u;a++<i;)if(34===e.charCodeAt(a)){if(34!==e.charCodeAt(a+1))break;a+=1}return s=a+2,o=e.charCodeAt(a+1),13===o?(c=!0,10===e.charCodeAt(a+2)&&(a+=1)):10===o&&(c=!0),e.substring(u+1,a)}for(;i>s;){if(o=e.charCodeAt(s++),d=1,10===o)c=!0;else if(13===o)c=!0,10===e.charCodeAt(s)&&(++s,++d);else if(o!==t.charCodeAt(0))continue;return e.substring(u,s-d)}return e.substring(u)};(u=d())!==r;){for(var f=[];u!==n&&u!==r;)f.push(u),u=d();""!==f[0]&&1!==f.length&&o.push(f)}return o},keys:function(e){var t=[];for(var n in e)t.push(n);return t},values:function(e){var t=[];if(e instanceof Array)t.concat(e);else for(var n in e)t.push(e[n]);return t}},CSV=function(t){return t=e.existance(t)?t:{},this.options={delimiter:e.existance(t.delimiter)?t.delimiter:",",header:e.existance(t.header)?t.header:!1,replace:e.existance(t.replace)?t.replace:!1,stream:e.existance(t.stream)?t.stream:void 0,done:e.existance(t.done)?t.done:void 0},this},CSV.prototype.set=function(e,t){switch(e){case"stream":this.stream(t);break;case"done":this.done(t);break;default:this.options[e]=t}},CSV.prototype.stream=function(t){return e.method(t)?this.options.stream=t:"No function provided."},CSV.prototype.done=function(t){return e.method(t)?this.options.done=t:"No function provided."},CSV.prototype.encode=function(e){var r,o,i,s,a,u,c;r=this.options.stream,o=this.options.done,i=this.options.header,s=i instanceof Array?i:!1,a=this.options.detailed,c=e,u={},u.data=this.options.header?s?i:t.encode(n.keys(c[0])):"";for(var d=0,f=c.length;f>d;d+=1){var h,p;h=c[d],p=t.encode(n.values(h)),r?r(p):u.data+=p}return o&&o(u),u},CSV.prototype.parse=function(e){var r,o,i,s,a,u;if(r=this.options.stream,o=this.options.done,i=this.options.header,s=this.options.replace,a=n.rows(e,this.options.delimiter),i){var c,d,f;c=i instanceof Array,d=c&&!s?a:a.slice(1),f=c?i:t.clean(a[0]),u=d.map(function(e){e=t.clean(e);for(var n={},o=0,i=e.length;i>o;o+=1)n[f[o]]=e[o];return r?void r(n):n})}else u=a.map(function(e){return e=t.clean(e),r?void r(e):e});return o&&o(reponse),u},"function"==typeof define&&define.amd?define(CSV):"object"==typeof module&&module.exports?module.exports=CSV:window.CSV=CSV}();