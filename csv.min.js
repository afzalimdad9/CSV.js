(function(){"use strict";var e="function"==typeof define&&define.amd,t="object"==typeof module&&module.exports,o=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,n=function(e){return!(!e||null===e)},CSV=function(e,t){return this.data=e,t=n(t)?t:{},this.options={cast:n(t.cast)?t.cast:!0,delimiter:n(t.delimiter)?t.delimiter:",",header:n(t.header)?t.header:!1,done:n(t.done)?t.done:void 0},this};CSV.prototype.set=function(e,t){return this.options[e]=t,this},CSV.format={cast:function(e){return o.test(e)?Number(e):e},stringify:function(e){return o.test(e)?e:'"'+e.replace(/\"/,'""')+'"'},encode:function(e,t){return e.map(CSV.format.stringify).join(t)+"\r\n"}},CSV.prototype.encode=function(e){e=e||[].push;var t=this.data,o=[],n=t[0]instanceof Array?"array":"object",i=this.options.header,r=i instanceof Array?i:[],c=this.options.delimiter,s=this.options.done,a=function(t){e.call(o,CSV.format.encode(t,c))};return"object"!==n||r.length||(r=Object.keys(t[0])),i&&a(r),t.forEach("object"===n?function(e){e=r.map(function(t){return e[t]}),a(e)}:function(e){a(e)}),s?s(o):o.join("")},CSV.prototype.parse=function(e){e=e||[].push;var t,o,n,i=this.data,r=[],c=this.options.done,s=this.options.header,a=s instanceof Array?s:[],l=0,u=a.length,p={row:[],cell:""},f={escaped:!1,quote:!1,cell:!0},d=function(e){for(l=0;u>l;++l)this[a[l]]=e[l]};a.forEach(function(e){d.prototype[e]=void 0}),t=function(){p.cell="",f={escaped:!1,quote:!1,cell:!0}},o=this.options.cast?function(e){p.row.push(CSV.format.cast((f.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim()))}:function(e){p.row.push((f.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim())},n=u?function(){e.call(r,new d(p.row))}:s?function(){u?e.call(r,new d(p.row)):(a=p.row,u=a.length)}:function(){e.call(r,p.row)};var h,m,y,w=i.length,g=this.options.delimiter.charCodeAt(0);for(h=0,m=0;w>m;++m)y=i.charCodeAt(m),f.cell&&(f.cell=!1,34===y)?f.escaped=!0:f.escaped&&34===y?f.quote=!f.quote:(f.escaped&&f.quote||!f.escaped)&&(y===g?(o(p.cell+i.slice(h,m)),h=m+1,t()):10===y?(o((p.cell+i.slice(h,m)).slice(0,-1)),h=m+1,n(),t(),p.row=[]):m===w-1&&(o(p.cell+i.slice(h,m+1)),n()));return c?c(r):r},CSV.prototype.forEach=function(e){return this.data instanceof Array?this.encode(e):this.parse(e)},CSV.prototype.each=CSV.prototype.forEach,e?define(CSV):t?module.exports=CSV:this.CSV=CSV}).call(this);