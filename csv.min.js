!function(){"use strict";var CSV=function(e){return e=e&&null!==e?e:{},this.options={delimiter:e.delimiter&&null!==e.delimiter?e.delimiter:",",header:e.header&&null!==e.header?e.header:!1,replace:e.replace&&null!==e.replace?e.replace:!1,stream:e.stream&&null!==e.stream?e.stream:void 0,done:e.done&&null!==e.done?e.done:void 0},this};CSV.format={cast:function(e){var t=e.toLowerCase();return""===t?e:isNaN(Number(e))?"true"===t||"t"===t||"yes"===t||"y"===t?!0:"false"===t||"f"===t||"no"===t||"n"===t?!1:(e=e.trim(),'"'===e.charAt(0)&&(e=e.substring(1,e.length)),'"'===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e.replace(/\"\"/g,'"')):Number(e)},stringify:function(e){return isNaN(Number(e))?'"'+e.replace(/\"/,'""')+'"':e},encode:function(e){return e.map(CSV.format.stringify).join(",")+"\r\n"}},CSV.rows=function(e,t,r){r=r&&r.constructor&&r.call&&r.apply?r:!1;var n,o,i,s,a,u,c,f,p;n={},o={},i=[],s=e.length,a=0,u=0,p=function(){if(a>=s)return o;if(f)return f=!1,n;var r=a;if(34===e.charCodeAt(r)){for(var i=r;i++<s;)if(34===e.charCodeAt(i)){if(34!==e.charCodeAt(i+1))break;i+=1}return a=i+2,u=e.charCodeAt(i+1),13===u?(f=!0,10===e.charCodeAt(i+2)&&(i+=1)):10===u&&(f=!0),e.substring(r+1,i)}for(;s>a;){var u=e.charCodeAt(a++),c=1;if(10===u)f=!0;else if(13===u)f=!0,10===e.charCodeAt(a)&&(++a,++c);else if(u!==t.charCodeAt(0))continue;return e.substring(r,a-c)}return e.substring(r)};var d;if(r)for(;(c=p())!==o;){for(d=[];c!==n&&c!==o;)d.push(c),c=p();""!==d[0]&&1!==d.length&&r(d.map(CSV.format.cast))}else for(;(c=p())!==o;){for(d=[];c!==n&&c!==o;)d.push(c),c=p();""!==d[0]&&1!==d.length&&i.push(d.map(CSV.format.cast))}return i},CSV.prototype.set=function(e,t){return this.options[e]=t,t},CSV.prototype.stream=function(e){return this.options.stream=e,e},CSV.prototype.done=function(e){return this.options.done=e,e},CSV.prototype.encode=function(e){var t,r,n,o,i,s;return t=this.options.stream,r=this.options.done,n=this.options.header,o=n instanceof Array?n:!1,i=this.options.detailed,s=n?o?n:CSV.format.encode(Object.keys(e[0])):"",e.forEach(function(e){var r=CSV.format.encode(e instanceof Array?e:Object.keys(e).map(function(t){return e[t]}));t?t(r):s+=r}),r?r(s):s},CSV.prototype.parse=function(e){var t,r,n,o,i;if(t=this.options.stream,r=this.options.done,n=this.options.header,o=CSV.rows(e,this.options.delimiter,t),n){var s,a,u;s=n instanceof Array,a=s&&!this.options.replace?o:o.slice(1),u=s?n:o[0],i=a.map(function(e){var r={};return e.forEach(function(e,t){r[u[t]]=e}),t?t(r):r})}else i=o.map(function(e){return t?t(e):e});return r?r(i):i},"function"==typeof define&&define.amd?define(CSV):"object"==typeof module&&module.exports?module.exports=CSV:window.CSV=CSV}();