(function(){"use strict";var e=function(e){return"undefined"!=typeof e},t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,n=function(e){return e=e.toLowerCase(),"true"===e||"false"===e},o=function(e,o,i,r){var s,c="return ",a=r?function(e,o){return t.test(e)?"Number(values["+o+"]),":n(e)?"Boolean(values["+o+"].toLowerCase() === 'true'),":"String(values["+o+"]),"}:function(e,t){return"values["+t+"],"};if("object"===e){for(c+="{",s=0;s<o.length;++s)c+='"'+o[s]+'": '+a(i[s],s);c=c.slice(0,-1)+"}"}else{for(c+="[",s=0;s<o.length;++s)c+=a(i[s],s);c=c.slice(0,-1)+"]"}return new Function("values",c)},i=function(t,n){return n=e(n)?n:{},this.options={async:e(n.async)?n.async:!1,cast:e(n.cast)?n.cast:!0,line:e(n.line)?n.line:"\r\n",delimiter:e(n.delimiter)?n.delimiter:",",header:e(n.header)?n.header:!1,done:e(n.done)?n.done:void 0},this.data=t,this};i.prototype.set=function(e,t){return this.options[e]=t,this},i.prototype.encode=function(e){if(0===this.data.length)return"";var t,n,o,i,r,s,c=this.data,a=[],l=this.options.delimiter,u=c[0]instanceof Array?"array":"object",h=this.options.header,f=this.options.done,d=function(e){return e?"string"!=typeof e?e:'"'+e.replace(/\"/g,'""')+'"':null},p=e?function(t){e(t.join(l))}:function(e){a.push(e.join(l))},w=c.length;if("object"===u?(o=Object.keys(c[0]),i=o.length):i=c[0].length,s=new Array(i),h){var y=h instanceof Array?h:o;for(n=0;i>n;++n)s[n]=d(y[n]);p(s)}if("object"===u)for(t=0;w>t;++t){for(r=c[t],n=0;i>n;++n)s[n]=d(r[o[n]]);p(s)}else for(t=0;w>t;++t){for(r=c[t],n=0;i>n;++n)s[n]=d(r[n]);p(s)}return a=a.join(this.options.line),f&&f(a),a},i.prototype.parse=function(e){if(0===this.data.trim().length)return[];var t,n,i,r,s=this.data,c=[],a=this.options.done,l=this.options.cast,u=this.options.header,h=u instanceof Array?u:[],f=this.options.line,d=h.length,p={row:[],cell:""},w={escaped:!1,quote:!1,cell:!0},y=function(e){p.row.push((w.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim()),p.cell="",w={escaped:!1,quote:!1,cell:!0}},g=1===f.length?y:function(e){y(e.slice(0,1-f.length))},m=e?function(){e(new t(p.row))}:function(){c.push(new t(p.row))},v=function(){u?d?(t=new o("object",h,p.row,l),m(),v=m):(h=p.row,d=h.length):(t||(t=new o("array",p.row,p.row,l)),m(),v=m)},j=s.length,A=f.charCodeAt(f.length-1),b=this.options.delimiter.charCodeAt(0);for(s.charCodeAt(j-1)!==A&&(s+=f),n=0,i=0;j>=i;++i)r=s.charCodeAt(i),w.cell&&(w.cell=!1,34===r)?w.escaped=!0:w.escaped&&34===r?w.quote=!w.quote:(w.escaped&&w.quote||!w.escaped)&&(r===b?(y(p.cell+s.slice(n,i)),n=i+1):r===A&&(g(p.cell+s.slice(n,i)),n=i+1,v(),p.row=[]));return a&&a(c),c},i.prototype.forEach=function(e){return this.data instanceof Array?this.encode(e):this.parse(e)},"function"==typeof define&&define.amd?define(function(){return i}):"object"==typeof module&&module.exports?module.exports=i:window&&this===window&&(this.CSV=i)}).call(this);