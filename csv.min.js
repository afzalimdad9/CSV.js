(function(){"use strict";var e=function(e){return"undefined"!=typeof e},t=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/,n=function(e){return e=e.toLowerCase(),"true"===e||"false"===e},o=function(e,o,i,r){var s,c="return ",a=r?function(e,o){return t.test(e)?"Number(values["+o+"]),":n(e)?"Boolean(values["+o+"].toLowerCase() === 'true'),":"String(values["+o+"]),"}:function(e,t){return"values["+t+"],"};if("object"===e){for(c+="{",s=0;s<o.length;++s)c+='"'+o[s]+'": '+a(i[s],s);c=c.slice(0,-1)+"}"}else{for(c+="[",s=0;s<o.length;++s)c+=a(i[s],s);c=c.slice(0,-1)+"]"}return new Function("values",c)},i=function(t,n){return n=e(n)?n:{},this.options={async:e(n.async)?n.async:!1,cast:e(n.cast)?n.cast:!0,line:e(n.line)?n.line:"\r\n",delimiter:e(n.delimiter)?n.delimiter:",",header:e(n.header)?n.header:!1,done:e(n.done)?n.done:void 0},this.data=t,this};i.prototype.set=function(e,t){return this.options[e]=t,this},i.prototype.encode=function(e){if(0===this.data.length)return"";var n,o,i,r,s,c,a=this.data,l=[],u=this.options.delimiter,h=a[0]instanceof Array?"array":"object",f=this.options.header,d=this.options.done,p=function(e){return t.test(e)?e:'"'+e.replace(/\"/g,'""')+'"'},w=e?function(t){e(t.join(u))}:function(e){l.push(e.join(u))},y=a.length;if("object"===h?(i=Object.keys(a[0]),r=i.length):r=a[0].length,c=new Array(r),f){var g=f instanceof Array?f:i;for(o=0;r>o;++o)c[o]=p(g[o]);w(c)}if("object"===h)for(n=0;y>n;++n){for(s=a[n],o=0;r>o;++o)c[o]=p(s[i[o]]);w(c)}else for(n=0;y>n;++n){for(s=a[n],o=0;r>o;++o)c[o]=p(s[o]);w(c)}return l=l.join(this.options.line),d&&d(l),l},i.prototype.parse=function(e){if(0===this.data.trim().length)return[];var t,n,i,r,s=this.data,c=[],a=this.options.done,l=this.options.cast,u=this.options.header,h=u instanceof Array?u:[],f=this.options.line,d=h.length,p={row:[],cell:""},w={escaped:!1,quote:!1,cell:!0},y=function(e){p.row.push((w.escaped?e.slice(1,-1).replace(/""/g,'"'):e).trim()),p.cell="",w={escaped:!1,quote:!1,cell:!0}},g=1===f.length?y:function(e){y(e.slice(0,1-f.length))},m=e?function(){e(new t(p.row))}:function(){c.push(new t(p.row))},v=function(){u?d?(t=new o("object",h,p.row,l),m(),v=m):(h=p.row,d=h.length):(t||(t=new o("array",p.row,p.row,l)),m(),v=m)},j=s.length,A=f.charCodeAt(f.length-1),b=this.options.delimiter.charCodeAt(0);for(s.charCodeAt(j-1)!==A&&(s+=f),n=0,i=0;j>=i;++i)r=s.charCodeAt(i),w.cell&&(w.cell=!1,34===r)?w.escaped=!0:w.escaped&&34===r?w.quote=!w.quote:(w.escaped&&w.quote||!w.escaped)&&(r===b?(y(p.cell+s.slice(n,i)),n=i+1):r===A&&(g(p.cell+s.slice(n,i)),n=i+1,v(),p.row=[]));return a&&a(c),c},i.prototype.forEach=function(e){return this.data instanceof Array?this.encode(e):this.parse(e)},"function"==typeof define&&define.amd?define(i):"object"==typeof module&&module.exports?module.exports=i:window&&this===window&&(this.CSV=i)}).call(this);