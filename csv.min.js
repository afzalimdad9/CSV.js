!function(){"use strict";function t(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function e(t){return"[object Array]"==toString.call(t)}function n(t){return"[object String]"===toString.call(t)}function i(t){return!isNaN(Number(t))}function r(t){return 0==t||1==t}function o(t){return null==t}function u(t){return null!=t}function c(t,e){return u(t)?t:e}function l(t,e){for(var n=0,i=t.length;i>n&&e(t[n],n)!==!1;)n++;return t}function a(t,e){return i(t)?"Number(attrs["+e+"])":r(t)?"Boolean(attrs["+e+"] == true)":"String(attrs["+e+"])"}function s(t,e){var n=[];return 1==arguments.length?(l(t,function(t,e){n.push(a(t,e))}),n="return ["+n.join(",")+"]"):(l(t,function(t,i){n.push('"'+e[i]+'": '+a(t,i))}),n="return {"+n.join(",")+"}"),new Function("attrs",n)}function f(t,e){var n,i=0;return l(e,function(e){var r,o=e;-1!=h.indexOf(e)&&(o="\\"+o),r=t.match(new RegExp(o,"g")),r&&r.length>i&&(i=r.length,n=e)}),n||e[0]}var h=["|","^"],p=[",",";","  ","|","^"],d=["\r\n","\r","\n"],m=function(){function i(t,i){if(i||(i={}),e(t))this.mode="encode";else{if(!n(t))throw new Error("Incompatible format!");this.mode="parse"}this.data=t,this.options={header:c(i.header,!1)};var r=i.lineDelimiter||i.line,o=i.cellDelimiter||i.delimiter;this.isParser()?(this.options.lineDelimiter=r||f(this.data,d),this.options.cellDelimiter=o||f(this.data,p),this.data=u(this.data,this.options.lineDelimiter)):this.isEncoder()&&(this.options.lineDelimiter=r||"\r\n",this.options.cellDelimiter=o||",")}function r(t,e,n){t(new e(n))}function u(t,e){return t.slice(-e.length)!=e&&(t+=e),t}function a(i){return e(i)?"array":t(i)?"object":n(i)?"string":o(i)?"null":"primitive"}return i.prototype.set=function(t,e){return this.options[t]=e},i.prototype.isParser=function(){return"parse"==this.mode},i.prototype.isEncoder=function(){return"encode"==this.mode},i.prototype.parse=function(t){function n(){a={escaped:!1,quote:!1,cell:!0}}function i(){g.cell=""}function o(){g.line=[]}function u(t){g.line.push(a.escaped?t.slice(1,-1).replace(/""/g,'"'):t),i(),n()}function c(t){u(t.slice(0,1-d.lineDelimiter.length))}function l(){m?e(m)?(f=s(g.line,m),(l=function(){r(t,f,g.line)})()):m=g.line:(f||(f=s(g.line)),(l=function(){r(t,f,g.line)})())}if("parse"==this.mode){if(0===this.data.trim().length)return[];var a,f,h,p=this.data,d=this.options,m=d.header,g={cell:"",line:[]};t||(h=[],t=function(t){h.push(t)}),n(),1==d.lineDelimiter.length&&(c=u);var y,v,j,D=p.length,b=d.cellDelimiter.charCodeAt(0),w=d.lineDelimiter.charCodeAt(d.lineDelimiter.length-1);for(y=0,v=0;D>y;y++)j=p.charCodeAt(y),a.cell&&(a.cell=!1,34==j)?a.escaped=!0:a.escaped&&34==j?a.quote=!a.quote:(a.escaped&&a.quote||!a.escaped)&&(j==b?(u(g.cell+p.slice(v,y)),v=y+1):j==w&&(c(g.cell+p.slice(v,y)),v=y+1,l(),o()));return h?h:this}},i.prototype.serialize={object:function(t){var e=this,n=Object.keys(t),i=Array(n.length);return l(n,function(n,r){i[r]=e[a(t[n])](t[n])}),i},array:function(t){var e=this,n=Array(t.length);return l(t,function(t,i){n[i]=e[a(t)](t)}),n},string:function(t){return'"'+t.replace(/"/g,'""')+'"'},"null":function(){return""},primitive:function(t){return t}},i.prototype.encode=function(t){function n(t){return t.join(u.cellDelimiter)}if("encode"==this.mode){if(0==this.data.length)return"";var i,r,o=this.data,u=this.options,c=u.header,s=o[0],f=this.serialize,h=0;t||(r=Array(o.length),t=function(t,e){r[e+h]=t}),c&&(e(c)||(i=Object.keys(s),c=i),t(n(f.array(c)),0),h=1);var p,d=a(s);return"array"==d?(p=Array(s.length),l(s,function(t,e){p[e]=a(t)}),l(o,function(e,i){var r=Array(p.length);l(e,function(t,e){r[e]=f[p[e]](t)}),t(n(r),i)})):"object"==d&&(i=Object.keys(s),p=Array(i.length),l(i,function(t,e){p[e]=a(s[t])}),l(o,function(e,r){var o=Array(i.length);l(i,function(t,n){o[n]=f[p[n]](e[t])}),t(n(o),r)})),r?r.join(u.lineDelimiter):this}},i.prototype.forEach=function(t){return this[this.mode](t)},i}();m.parse=function(t,e){return new m(t,e).parse()},m.encode=function(t,e){return new m(t,e).encode()},m.forEach=function(t,e,n){return 2==arguments.length&&(n=e),new m(t,e).forEach(n)},"function"==typeof define&&define.amd?define("CSV",[],function(){return m}):"object"==typeof module&&module.exports?module.exports=m:window&&(window.CSV=m)}();