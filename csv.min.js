!function(){"use strict";var CSV=function(e){var t=function(e){return!(!e||null===e)};return e=t(e)?e:{},this.options={delimiter:t(e.delimiter)?e.delimiter:",",header:t(e.header)?e.header:!1,stream:t(e.stream)?e.stream:void 0,done:t(e.done)?e.done:void 0},this};CSV.format={cast:function(e){var t=e.toLowerCase();return""===t?void 0:isNaN(Number(e))?"true"===t||"t"===t||"yes"===t||"y"===t?!0:"false"===t||"f"===t||"no"===t||"n"===t?!1:void 0:Number(e)},stringify:function(e){return isNaN(Number(e))?'"'+e.replace(/\"/,'""')+'"':e},encode:function(e){return e.map(CSV.format.stringify).join(",")+"\r\n"}},CSV.prototype.set=function(e,t){return this.options[e]=t,this.options},CSV.prototype.encode=function(e){var t,o,r,n,i,a;return t=[],o=e[0]instanceof Array?"array":"object",n=this.options.header,i=this.options.stream||[].push,a=this.options.done,"object"===o?(r=Object.keys(e[0]),i.call(t,CSV.format.encode(r)),e.forEach(function(e){e=r.map(function(t){return e[t]}),i.call(t,CSV.format.encode(e))})):(n&&n instanceof Array&&i.call(t,CSV.format.encode(n)),e.forEach(function(e){i.call(t,CSV.format.encode(e))})),a?a(t):t.join("")},CSV.prototype.parse=function(e){var t,o,r,n,i,a,c,s,l;t=[],o=this.options.stream||[].push,r=this.options.done,n=this.options.header,i=n instanceof Array?n:[],a={row:[],cell:""},c={escaped:!1,quote:!1,cell:!0},s=function(e){c.escaped&&(e=e.slice(1,-1).replace(/""/g,'"')),a.row.push(e.trim()),a.cell="",c={escaped:!1,quote:!1,cell:!0}},l=function(){var e=a.row.map(CSV.format.cast);if(i&&i.length){for(var r={},c=0,s=i.length;s>c;++c)r[i[c]]=e[c];o.call(t,r)}else n?i=n instanceof Array?n:e:o.call(t,e);a.row=[]};for(var d,u=0,f=0,p=e.length,m=this.options.delimiter.charCodeAt(0);p>=f;++f)d=e.charCodeAt(f),c.cell&&(c.cell=!1,34===d)?c.escaped=!0:c.escaped&&34===d?c.quote=!c.quote:(c.escaped&&c.quote||!c.escaped)&&(d===m?(s(a.cell+e.slice(u,f)),u=f+1):(10===d||f===p)&&(s((a.cell+e.slice(u,f)).slice(0,-1)),u=f+1,l()));return r?r(t):t},"function"==typeof define&&define.amd?define(CSV):"object"==typeof module&&module.exports?module.exports=CSV:window.CSV=CSV}();