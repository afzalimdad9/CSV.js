(function(){"use strict";var CSV,confirm,format,get;confirm={existance:function(possible){return!!(possible&&possible!==null)},number:function(possible){return!isNaN(Number(possible))},method:function(possible){return!!(possible&&possible.constructor&&possible.call&&possible.apply)}};format={value:function(string){return string.replace(/(^\s+|\s+$)/g,"").replace(/(^")|("$)/g,"").replace(/[\n|\r]/g,"").replace(/\"\"/,'"')},decode:function(string){if(string===""){return string}else if(confirm.number(string)){return Number(string)}else if(string.toLowerCase()==="true"){return true}else if(string.toLowerCase()==="false"){return false}else{return format.value(string)}},encode:function(array){return array.map(function(element){if(confirm.number(element)){return element}else{return'"'+element+'"'}}).join(",")+"\n"},split:function(text,delimiter){return text.split(delimiter).map(function(item){return format.decode(item)})}};get={keys:function(object){var results=[];for(var key in object)results.push(key);return results},values:function(object){var results=[];if(object instanceof Array){results.concat(object)}else{for(var key in object)results.push(object[key])}return results}};CSV=function(options){options=confirm.existance(options)?options:{};this.options={line:confirm.existance(options.line)?options.line:/[\r|\n]/,delimiter:confirm.existance(options.delimiter)?options.delimiter:/,/,header:confirm.existance(options.header)?options.header:false,replace:confirm.existance(options.replace)?options.replace:false,stream:confirm.existance(options.stream)?options.stream:undefined,done:confirm.existance(options.done)?options.done:undefined,detailed:confirm.existance(options.detailed)?options.detailed:false};return this};CSV.prototype.set=function(option,value){switch(option){case"stream":this.stream(value);break;case"done":this.done(value);break;default:this.options[option]=value}};CSV.prototype.stream=function(method){return confirm.method(method)?this.options.stream=method:"No function provided."};CSV.prototype.done=function(method){return confirm.method(method)?this.options.done=method:"No function provided."};CSV.prototype.encode=function(array){var stream,complete,header,supplied,detailed,response,data,getValues;stream=this.options.stream;complete=this.options.done;header=this.options.header;supplied=header instanceof Array?header:false;detailed=this.options.detailed;data=array;response={};if(this.options.header){response.data=supplied?header:format.encode(get.keys(data[0]))}else{response.data=""}for(var _i=0,_len=data.length;_i<_len;_i+=1){var object,values;object=data[_i];values=format.encode(get.values(object));if(stream){stream(values)}else{response.data+=values}if(complete){complete(response)}}return detailed?response:response.data};CSV.prototype.parse=function(text){var delimiter,stream,complete,header,replace,detailed,data,rows,response;delimiter=this.options.delimiter;stream=this.options.stream;complete=this.options.done;header=this.options.header;replace=this.options.replace;detailed=this.options.detailed;data=[];rows=format.split(text,this.options.line).filter(function(item){return item.length>0});if(header){(function(){var supplied,fields;supplied=header instanceof Array;fields=supplied?header:format.split(rows[0],delimiter);rows=supplied&&!replace?rows:rows.slice(1);for(var _i=0,_len=rows.length;_i<_len;_i+=1){var row,object;row=format.split(rows[_i],delimiter);object={};for(var _n=0,_len2=row.length;_n<_len2;_n+=1){object[fields[_n]]=row[_n]}if(stream){stream(object)}else{data.push(object)}}response={fields:fields,data:data}})()}else{(function(){for(var _i=0,_len=rows.length;_i<_len;_i+=1){var row,object;row=format.split(rows[_i],delimiter);object=[];for(var _n=0,_len2=row.length;_n<_len2;_n+=1){object.push(row[_n])}if(stream){stream(object)}else{data.push(object)}}response={data:data}})()}response=detailed?response:response.data;if(complete)complete(reponse);return response};if(typeof define==="function"&&define.amd){define(CSV)}else if(typeof module==="object"&&module.exports){module.exports=CSV}else{window.CSV=CSV}})();